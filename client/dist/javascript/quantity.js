!function(u){function e(t){return t.parent().find("input[name='x:visibleQuantity']").data("link")}function r(t){return t.parent().find("input[name='x:visibleQuantity']").data("code")}function d(t){return t.parent().find("input[name='x:visibleQuantity']").data("id")}function o(t){return t.parent().parent().find("input[name='x:visibleQuantity']")}function s(t){t.parent().find("button.increase, button.reduced").attr("disabled",!0).addClass("hidden")}function c(t){var n=t.parents("form[id^=FoxyStripePurchaseForm_PurchaseForm_]"),i=n.attr("id");n.find("fieldset").html('<h4 id="'+i+'_unavailableText">Currently Out of Stock</h4>'),n.find("input[name=action_x\\:submit]").remove()}function f(t){t.parent().parent().parent().find(".fs-add-to-cart-button").attr("disabled",!0)}function l(){m.data("fetch",1)}function p(t,n,i,a,e){var r={code:t,value:n,id:a,isAjax:1};u.ajax({type:"get",url:function(t,n){var i="?";return-1!=t.indexOf("?")&&(i="&"),t+i+u.param(n)}(i,r)}).done(function(t){var n=JSON.parse(t);if(n.hasOwnProperty("limit")){!function(t,n){t.parent().find("input[name='x:visibleQuantity']").data("limit",n)}(e,n.limit);var i=o(e);n.limit<i.val()&&i.val(n.limit),0==n.limit?c(e):1==n.limit?s(e):n.limit==n.quantity?function(t){t.parent().find("button.increase").attr("disabled",!0)}(e):function(t){t.parent().find("button.increase").attr("disabled",!1)}(e)}e.parent().parent().parent().parent().find("input[name='quantity']").val(n.quantityGenerated),m.data("fetch",0),function(t){t.parent().parent().parent().find(".fs-add-to-cart-button").attr("disabled",!1)}(e)}).fail(function(t){404==t.status&&"I can't handle sub-URLs on class SilverStripe\\Forms\\FormRequestHandler."==t.responseText?c(e):console.log("Error: "+t.responseText)})}var m=u("input[name='x:visibleQuantity']");u("input[name='quantity']");u(document).on("click","button.increase",function(t){var n=o(u(this)),i=n.val(),a=parseInt(i)+1;l(),f(u(this)),p(r(u(this)),a,e(u(this)),d(u(this)),u(this)),n.val(a)}),u(document).on("click","button.reduced",function(t){m.data("fetch",1);var n=o(u(this)),i=n.val(),a=parseInt(i)-1;1<i&&(l(),f(u(this)),p(r(u(this)),a,e(u(this)),d(u(this)),u(this)),n.val(a))}),u(document).ready(function(){u("button.increase").each(function(){var t=function(t){return t.parent().find("input[name='x:visibleQuantity']").data("limit")}(u(this));1==t?s(u(this)):0==t&&c(u(this))})})}(jQuery);